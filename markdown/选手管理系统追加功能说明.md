# é€‰æ‰‹ç®¡ç†ç³»ç»Ÿè¿½åŠ åŠŸèƒ½å®ç°

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å·²æˆåŠŸä¸ºé€‰æ‰‹ç®¡ç†ç³»ç»Ÿå®ç°äº†ä¸è§£è¯´å‘˜ç³»ç»Ÿç›¸åŒçš„è¿½åŠ åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

1. **è¿½åŠ ä¿å­˜æœºåˆ¶** - é€‰æ‰‹æ•°æ®ä»¥è¿½åŠ æ–¹å¼ä¿å­˜ï¼Œè€Œéè¦†å†™
2. **ä¿¡å·é€šä¿¡ç³»ç»Ÿ** - ç¼–è¾‘å™¨ä¸é€‰æ‹©ç•Œé¢ä¹‹é—´çš„å®æ—¶æ•°æ®åŒæ­¥
3. **å®Œæ•´é‡å¯åŠŸèƒ½** - æ•°æ®æ›´æ–°æ—¶çš„å…¨é¢çŠ¶æ€æ¢å¤

## ğŸ“‹ å·²å®ç°çš„åŠŸèƒ½

### 1. é€‰æ‰‹ç¼–è¾‘å™¨ (`player_editor.gd`) æ”¹è¿›

#### æ–°å¢ä¿¡å·ç³»ç»Ÿ
```gdscript
signal player_data_updated()  # é€‰æ‰‹æ•°æ®æ›´æ–°ä¿¡å·
```

#### è¿½åŠ ä¿å­˜é€»è¾‘
- **åŠ è½½ç°æœ‰é€‰æ‰‹**: `_load_existing_players()` - è¯»å–ç°æœ‰é€‰æ‰‹åˆ—è¡¨
- **æ£€æŸ¥é‡å¤**: æ ¹æ®é€‰æ‰‹IDæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼Œå¦‚å­˜åœ¨åˆ™æ›´æ–°ï¼Œå¦åˆ™è¿½åŠ 
- **å†™å…¥æ–‡ä»¶**: `_write_players_file()` - å°†å®Œæ•´é€‰æ‰‹åˆ—è¡¨å†™å…¥æ–‡ä»¶
- **è¡¨å•æ¸…ç†**: `_clear_form()` - ä¿å­˜æˆåŠŸåæ¸…ç©ºè¡¨å•

#### ç»„æ³¨å†Œå’Œä¿¡å·å‘å°„
```gdscript
func _ready():
    add_to_group("player_editors")  # åŠ å…¥é€‰æ‰‹ç¼–è¾‘å™¨ç»„
    # ...å…¶ä»–åˆå§‹åŒ–ä»£ç 

# ä¿å­˜æˆåŠŸæ—¶å‘å°„ä¿¡å·
if _write_players_file(players_list):
    _show_message_dialog("æˆåŠŸ", "é€‰æ‰‹å·²ä¿å­˜/æ›´æ–°")
    player_data_updated.emit()  # å‘é€æ•°æ®æ›´æ–°ä¿¡å·
    _clear_form()
```

### 2. é€‰æ‰‹é€‰æ‹©ç•Œé¢ (`now_player.gd`) æ”¹è¿›

#### ä¿¡å·è¿æ¥æœºåˆ¶
- **è‡ªåŠ¨è¿æ¥**: `_connect_to_editor_signals()` - è‡ªåŠ¨æŸ¥æ‰¾å¹¶è¿æ¥ç¼–è¾‘å™¨ä¿¡å·
- **å»¶è¿Ÿè¿æ¥**: `_delayed_connect_to_editors()` - ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹å‡†å¤‡å°±ç»ªåè¿æ¥
- **å¤šè·¯å¾„æŸ¥æ‰¾**: æ”¯æŒç»„æŸ¥æ‰¾å’Œè·¯å¾„æŸ¥æ‰¾ä¸¤ç§æ–¹å¼

#### å®Œæ•´é‡å¯åŠŸèƒ½
```gdscript
func _on_player_data_updated() -> void:
    # é‡æ–°åŠ è½½é€‰æ‰‹æ•°æ®
    reload_players()
    # é‡æ–°åŠ è½½å½“å‰é€‰æ‰‹ç¼“å­˜  
    _load_current_player_cache()
    # æ ¹æ®ç¼“å­˜æ¢å¤é€‰æ‹©çŠ¶æ€
    _restore_selection_from_cache()
    # æ›´æ–°UIæ˜¾ç¤º
    _update_ui()
```

#### ç¼“å­˜ç®¡ç†
- **ç¼“å­˜åŠ è½½**: `_load_current_player_cache()` - ä» `current_player.json` åŠ è½½ç”¨æˆ·é€‰æ‹©
- **çŠ¶æ€æ¢å¤**: `_restore_selection_from_cache()` - æ ¹æ®ç¼“å­˜æ¢å¤UIé€‰æ‹©çŠ¶æ€

## ğŸ”„ æ•°æ®æµç¨‹

### é€‰æ‰‹è¿½åŠ æµç¨‹
1. **ç”¨æˆ·è¾“å…¥** - åœ¨ç¼–è¾‘å™¨ä¸­è¾“å…¥é€‰æ‰‹ä¿¡æ¯
2. **åŠ è½½ç°æœ‰æ•°æ®** - è¯»å– `players.json` ä¸­çš„ç°æœ‰é€‰æ‰‹åˆ—è¡¨
3. **æ£€æŸ¥é‡å¤** - æ ¹æ®é€‰æ‰‹IDæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
4. **è¿½åŠ æˆ–æ›´æ–°** - å¦‚æœæ˜¯æ–°é€‰æ‰‹åˆ™è¿½åŠ ï¼Œå¦‚æœå·²å­˜åœ¨åˆ™æ›´æ–°
5. **ä¿å­˜æ–‡ä»¶** - å°†å®Œæ•´åˆ—è¡¨å†™å…¥ `players.json`
6. **å‘å°„ä¿¡å·** - å‘å°„ `player_data_updated` ä¿¡å·
7. **æ¸…ç©ºè¡¨å•** - é‡ç½®ç¼–è¾‘å™¨ç•Œé¢

### ä¿¡å·åŒæ­¥æµç¨‹
1. **ç¼–è¾‘å™¨å‘å°„ä¿¡å·** - `player_data_updated.emit()`
2. **é€‰æ‹©ç•Œé¢æ¥æ”¶** - `_on_player_data_updated()` è¢«è°ƒç”¨
3. **é‡æ–°åŠ è½½æ•°æ®** - ä»æ–‡ä»¶é‡æ–°è¯»å–é€‰æ‰‹åˆ—è¡¨
4. **åŠ è½½ç¼“å­˜** - è¯»å–ç”¨æˆ·ä¹‹å‰çš„é€‰æ‹©çŠ¶æ€
5. **æ¢å¤é€‰æ‹©** - æ ¹æ®ç¼“å­˜æ¢å¤UIé€‰æ‹©
6. **æ›´æ–°æ˜¾ç¤º** - åˆ·æ–°æ‰€æœ‰ç›¸å…³UIå…ƒç´ 

## ğŸ“ æ–‡ä»¶ç»“æ„

### æ•°æ®æ–‡ä»¶
- `user://userdata/players/players.json` - é€‰æ‰‹åˆ—è¡¨ï¼ˆè¿½åŠ ä¿å­˜ï¼‰
- `user://userdata/players/current_player.json` - å½“å‰é€‰æ‹©ç¼“å­˜
- `user://userdata/players/player_icons/` - é€‰æ‰‹å¤´åƒç›®å½•

### è„šæœ¬æ–‡ä»¶
- `scripts/data/player_editor.gd` - é€‰æ‰‹ç¼–è¾‘å™¨ï¼ˆå‘å°„ä¿¡å·ï¼‰
- `scripts/ui/now_player.gd` - é€‰æ‰‹é€‰æ‹©ç•Œé¢ï¼ˆæ¥æ”¶ä¿¡å·ï¼‰
- `scripts/ui/player_signal_test.gd` - ä¿¡å·æµ‹è¯•è„šæœ¬

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

### æ•°æ®éªŒè¯
- å¿…å¡«å­—æ®µæ£€æŸ¥ï¼ˆé€‰æ‰‹åç§°ã€é˜Ÿä¼åç§°ç­‰ï¼‰
- å¤´åƒæ–‡ä»¶éªŒè¯
- æ•°æ®æ ¼å¼éªŒè¯

### æ–‡ä»¶æ“ä½œ
- è‡ªåŠ¨åˆ›å»ºç¼ºå¤±ç›®å½•
- JSON è§£æé”™è¯¯å¤„ç†
- æ–‡ä»¶è¯»å†™é”™è¯¯å¤„ç†
- ç¼“å­˜æ•°æ®ä¸åŒ¹é…å¤„ç†

### ä¿¡å·è¿æ¥
- ç¼–è¾‘å™¨èŠ‚ç‚¹æŸ¥æ‰¾å¤±è´¥å¤„ç†
- é‡å¤è¿æ¥é¿å…
- è¿æ¥çŠ¶æ€è°ƒè¯•è¾“å‡º

## ğŸ”§ è°ƒè¯•è¾“å‡º

ç³»ç»Ÿæä¾›è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š

```
âœ… é€‰æ‰‹ç¼–è¾‘å™¨å·²åŠ å…¥ player_editors ç»„
Loading existing players from: user://userdata/players/players.json
Loaded X existing players
ğŸ“¡ å‘å°„é€‰æ‰‹æ•°æ®æ›´æ–°ä¿¡å·ï¼ˆæ–°å¢/æ›´æ–°ç°æœ‰ï¼‰
ğŸ”„ æ¥æ”¶åˆ°é€‰æ‰‹æ•°æ®æ›´æ–°ä¿¡å·ï¼Œå¼€å§‹é‡æ–°åŠ è½½...
Reloading players data and cache...
Loading current player cache from: user://userdata/players/current_player.json
Restoring player selection from cache: [é€‰æ‰‹ID]
âœ… é€‰æ‰‹æ•°æ®ã€ç¼“å­˜å’Œé€‰æ‹©çŠ¶æ€åˆ·æ–°å®Œæˆ
```

## ğŸ¯ ä¸è§£è¯´å‘˜ç³»ç»Ÿçš„ä¸€è‡´æ€§

é€‰æ‰‹ç³»ç»Ÿç°åœ¨ä¸è§£è¯´å‘˜ç³»ç»Ÿå…·æœ‰ç›¸åŒçš„åŠŸèƒ½ç‰¹æ€§ï¼š

| åŠŸèƒ½ | è§£è¯´å‘˜ç³»ç»Ÿ | é€‰æ‰‹ç³»ç»Ÿ |
|------|------------|----------|
| è¿½åŠ ä¿å­˜ | âœ… | âœ… |
| ä¿¡å·é€šä¿¡ | âœ… | âœ… |
| è‡ªåŠ¨è¿æ¥ | âœ… | âœ… |
| ç¼“å­˜æ¢å¤ | âœ… | âœ… |
| å®Œæ•´é‡å¯ | âœ… | âœ… |
| ç»„æ³¨å†Œ | `announcer_editors` | `player_editors` |
| ä¿¡å·åç§° | `announcer_data_updated` | `player_data_updated` |

## ğŸ‰ æ€»ç»“

é€‰æ‰‹ç®¡ç†ç³»ç»Ÿç°åœ¨å®Œå…¨æ”¯æŒï¼š

1. **è¿½åŠ å…³ç³»** - æ–°é€‰æ‰‹ä¼šæ·»åŠ åˆ°ç°æœ‰åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯è¦†ç›–æ•´ä¸ªæ–‡ä»¶
2. **å®æ—¶åŒæ­¥** - ç¼–è¾‘å™¨ä¿å­˜åï¼Œé€‰æ‹©ç•Œé¢ç«‹å³è‡ªåŠ¨åˆ·æ–°
3. **çŠ¶æ€ä¿æŒ** - ç”¨æˆ·çš„é€‰æ‹©åœ¨æ•°æ®æ›´æ–°åå¾—åˆ°ä¿æŒ
4. **ä¸€è‡´ä½“éªŒ** - ä¸è§£è¯´å‘˜ç³»ç»Ÿç›¸åŒçš„äº¤äº’æ¨¡å¼

è¿™ç¡®ä¿äº†æ•´ä¸ªæ¯”èµ›ç®¡ç†ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§å’Œç”¨æˆ·ä½“éªŒçš„è¿ç»­æ€§ã€‚
